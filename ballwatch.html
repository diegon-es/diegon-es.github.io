<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <title>Ball Watch</title>
    <style type="text/css">
	html,body { background:#fff; height:100%; margin:0; padding:0; overflow:hidden }
	canvas { position:fixed;}
    </style>
    <script type="application/javascript">


// Developed by jesus@diegon.es just for fun

var BALL_RADIUS=0.025;
var GRAVITY_COEF=0.01;
var GRAVITY_POWER=0.1;
var ELASTICITY_COEF=0.01;
var RESISTANCE_COEF=0.05;
var REPULSION_SPEED=1;
var ANIMATION_FPS=25;

var balls=[];
var canvas=null;
var dc=null;
var wradius=-1;

function PaintBalls(){
  dc.beginPath();
  dc.arc(wradius, wradius, wradius, 0, 2 * Math.PI, false);
  dc.fillStyle = "#f0f0f0";
  dc.fill();
  for(var i=0; i<balls.length; i++){
    var ball=balls[i];
    dc.beginPath();
    dc.arc(wradius+ball.x*wradius, wradius+ball.y*wradius, BALL_RADIUS*wradius, 0, 2*Math.PI, false);
    dc.fillStyle="black";
    dc.fill();
  }
  dc.beginPath();
  dc.arc(wradius,wradius, wradius, 0, 2*Math.PI, false);
  dc.arc(wradius,wradius, wradius*1.5, 0, 2*Math.PI, true);
  dc.fillStyle="white";
  dc.fill();
}

function MoveBalls(){
  var i, j;
  setTimeout(MoveBalls,1000/ANIMATION_FPS);
  for(i=0; i<balls.length; i++){
    var ball=balls[i];
    var gv=GRAVITY_COEF*Math.pow((ball.x-ball.targetx)*(ball.x-ball.targetx)+(ball.y-ball.targety)*(ball.y-ball.targety),GRAVITY_POWER);
    ball.vx=ball.vx*(1-RESISTANCE_COEF)+(ball.targetx-ball.x)*gv;
    ball.vy=ball.vy*(1-RESISTANCE_COEF)+(ball.targety-ball.y)*gv;
    ball.x+=ball.vx;
    ball.y+=ball.vy;
    if((ball.x*ball.x+ball.y*ball.y)>(1-BALL_RADIUS)*(1-BALL_RADIUS)){
      var a=ball.vx*ball.vx+ball.vy*ball.vy;
      var b=2*ball.x*ball.vx+2*ball.y*ball.vy;
      var c=ball.x*ball.x+ball.y*ball.y-(1-BALL_RADIUS)*(1-BALL_RADIUS);
      var k=b*b-4*a*c;
      if(k>=0){
        k=Math.sqrt(k);
        var h=(-b+k)/(2*a);
        var xc1=ball.x+h*ball.vx;
        var yc1=ball.y+h*ball.vy;
        h=(-b-k)/(2*a);
        var xc2=ball.x+h*ball.vx;
        var yc2=ball.y+h*ball.vy;
        if((ball.x-xc1)*(ball.x-xc1)+(ball.y-yc1)*(ball.y-yc1)>(ball.x-xc2)*(ball.x-xc2)+(ball.y-yc2)*(ball.y-yc2)){
          xc1=xc2;
          yc1=yc2;
        }
        var r=(-yc1*ball.vx+xc1*ball.vy)/(xc1*xc1+yc1*yc1);
        ball.vx=(2*(-yc1*r)-ball.vx)*(1-ELASTICITY_COEF);
        ball.vy=(2*(xc1*r)-ball.vy)*(1-ELASTICITY_COEF);
        ball.x=xc1;
        ball.y=yc1;
      }else{
        var h=Math.sqrt((1-BALL_RADIUS)*(1-BALL_RADIUS)/(ball.x*ball.x+ball.y*ball.y));
        ball.vx=0;
        ball.vy=0;
        ball.x*=h;
        ball.y*=h;
      }
    }
  }
  
  for(i=0;i<balls.length-1;i++){
    var ball1=balls[i];
    for(j=i+1;j<balls.length;j++){
      var ball2=balls[j];
      var dx=ball1.x-ball2.x;
      var dy=ball1.y-ball2.y;
      var d=dx*dx+dy*dy;
      if(d<4*BALL_RADIUS*BALL_RADIUS){
        d=Math.sqrt(d);
        d=(2*BALL_RADIUS-d)/(d*2);
        dx*=d;
        dy*=d;
        ball1.x+=dx;
        ball2.x-=dx;
        ball1.y+=dy;
        ball2.y-=dy;
        var z=ball1.vx;
        ball1.vx=ball2.vx*(1-ELASTICITY_COEF)+dx*REPULSION_SPEED;
        ball2.vx=z*(1-ELASTICITY_COEF)-dx*REPULSION_SPEED;
        z=ball1.vy;
        ball1.vy=ball2.vy*(1-ELASTICITY_COEF)+dy*REPULSION_SPEED;
        ball2.vy=z*(1-ELASTICITY_COEF)-dy*REPULSION_SPEED;
      }
    }
  }
  PaintBalls();
}

function AddBall(){
  while(true){
    var x=Math.random()*2-1;
    var y=Math.random()*2-1;
    if(x*x+y*y<(1-BALL_RADIUS)*(1-BALL_RADIUS)){
      var occupied=false;
      for(var i=0; i<balls.length; i++){
        var ball=balls[i];
        if((ball.x-x)*(ball.x-x)+(ball.y-y)*(ball.y-y)<=4*BALL_RADIUS*BALL_RADIUS){
          occupied=true;
          break;
        }
      }
      if(!occupied)
        break;
    }
  }
  var ball={x:x, y:y, targetx:x, targety:y, vx:0, vy:0}
  balls.push(ball);
  return balls.length-1;
}

function RemoveBall(i){
  balls.splice(i,1);
}

function SetBallTarget(i,x,y){
  if(x*x+y*y>(1-BALL_RADIUS)*(1-BALL_RADIUS)){
    var k=Math.sqrt((1-BALL_RADIUS)*(1-BALL_RADIUS)/(x*x+y*y));
    x=x*k;
    y=y*k;
  }
  var ball=balls[i];
  ball.targetx=x;
  ball.targety=y;
}

function SetNBalls(n){
  if(n<0)
    n=0;
  while(n>balls.length)
    AddBall();
  while(n<balls.length)
    RemoveBall(Math.floor(Math.random()*balls.length));
  return n;
}

function GetNBalls(){
  return balls.length;
}

var bDigital=true;
var lastmin="";

function initWatch(){
  resizeWatch();
  MoveBalls();
  checkTime();
}

function checkTime(){
  setTimeout(checkTime,100);
  var d=new Date();
  var now=("0"+d.getHours()).substr(-2)+("0"+d.getMinutes()).substr(-2);
  if(now!=lastmin){
    lastmin=now;
    refreshWatch();
  }
}

function resizeWatch(){
  if(!canvas)
    canvas=document.getElementById("canvas");
  var w=document.body.offsetWidth;
  if(w>document.body.offsetHeight)
    w=document.body.offsetHeight;
  if((canvas.width!=w)||(canvas.height!=w)||(wradius!=(w/2))){
    canvas.width=w;
    canvas.height=w;
    canvas.style.left=(document.body.offsetWidth-w)/2+"px";
    canvas.style.top=(document.body.offsetHeight-w)/2+"px";
    wradius=w/2;
    dc=null;
  }
  if(!dc){
    dc = canvas.getContext('2d');
  }
}

function canvasClick(){
  bDigital=!bDigital;
  refreshWatch();
}


var avail=[];

function getAvail(){
  return avail.pop();
}

function getNAvail(){
  return avail.length;
}

function setAvail(n){
  n=SetNBalls(n);
  var allballs=[];
  var i;
  for(i=0;i<n;i++)
    allballs.push(i);
  avail=[];
  for(i=0;i<n;i++){
    var k=Math.floor(Math.random()*allballs.length);
    avail.push(allballs[k]);
    allballs.splice(k,1);
  }
}

function refreshWatch(){
  if(bDigital){
    drawDigital();
  }else{
    drawAnalog();
  }
}

function paintPixel(x,y){
  SetBallTarget(getAvail(),x*0.08-0.55,y*0.08-0.75);
}

function paintLine(x,y,dx,dy,n){
  for(;n>0;n--){
    paintPixel(x,y);
    x+=dx;
    y+=dy;
  }
}

function paintDigit(digit,x,y){
  if(digit=="0"){
    paintLine(0+x,0+y,0,1,7);
    paintLine(4+x,0+y,0,1,7);
    paintLine(1+x,0+y,1,0,3);
    paintLine(1+x,6+y,1,0,3);
  }else
  if(digit=="1"){
    paintLine(4+x,0+y,0,1,7);
  }else
  if(digit=="2"){
    paintLine(0+x,0+y,1,0,5);
    paintLine(4+x,1+y,0,1,3);
    paintLine(0+x,3+y,1,0,4);
    paintLine(0+x,4+y,0,1,3);
    paintLine(1+x,6+y,1,0,4);
  }else
  if(digit=="3"){
    paintLine(4+x,0+y,0,1,7);
    paintLine(0+x,0+y,1,0,4);
    paintLine(0+x,3+y,1,0,4);
    paintLine(0+x,6+y,1,0,4);
  }else
  if(digit=="4"){
    paintLine(4+x,0+y,0,1,7);
    paintLine(0+x,3+y,1,0,4);
    paintLine(0+x,0+y,0,1,3);
  }else
  if(digit=="5"){
    paintLine(0+x,0+y,1,0,5);
    paintLine(0+x,1+y,0,1,3);
    paintLine(1+x,3+y,1,0,4);
    paintLine(4+x,4+y,0,1,3);
    paintLine(0+x,6+y,1,0,4);
  }else
  if(digit=="6"){
    paintLine(0+x,0+y,0,1,7);
    paintLine(4+x,3+y,0,1,4);
    paintLine(1+x,0+y,1,0,4);
    paintLine(1+x,3+y,1,0,3);
    paintLine(1+x,6+y,1,0,3);
  }else
  if(digit=="7"){
    paintLine(4+x,0+y,0,1,7);
    paintLine(0+x,0+y,1,0,4);
  }else
  if(digit=="8"){
    paintLine(0+x,0+y,0,1,7);
    paintLine(4+x,0+y,0,1,7);
    paintLine(1+x,0+y,1,0,3);
    paintLine(1+x,3+y,1,0,3);
    paintLine(1+x,6+y,1,0,3);
  }else
  if(digit=="9"){
    paintLine(4+x,0+y,0,1,7);
    paintLine(0+x,3+y,1,0,4);
    paintLine(0+x,0+y,0,1,3);
    paintLine(1+x,0+y,1,0,3);
  }else
  {}
}

function drawDigital(){
  setAvail(86);
  paintDigit(lastmin.substr(0,1),2,2);
  paintDigit(lastmin.substr(1,1),8,2);
  paintDigit(lastmin.substr(2,1),2,11);
  paintDigit(lastmin.substr(3,1),8,11);
  var n=getNAvail();
  if(n){
    var delta=2*Math.PI/n;
    for(var i=0;i<n;i++){
      SetBallTarget(getAvail(),0.95*Math.cos(i*delta),0.95*Math.sin(i*delta));
    }
  }
}

function drawAnalog(){
  var i,nhide;
  var deltah=Math.PI/6;
  var deltam=Math.PI/30;
  var h=parseInt(lastmin.substr(0,2));
  var m=parseInt(lastmin.substr(2,2));
  if(h>11)
    h-=12;
  var alfah=(h+m/60)*deltah;
  var alfam=m*deltam;
  var alfad=Math.abs(alfah-alfam);
  var nhide=(alfad<0.01)?1000:Math.ceil(0.32/Math.sin(alfad/2));
  if(nhide>10)
    nhide=10;
  setAvail(34-nhide);
  for(i=0;i<12;i++)
    SetBallTarget(getAvail(),0.965*Math.cos(i*deltah),0.95*Math.sin(i*deltah));
  for(i=0;i<12;i++)
    SetBallTarget(getAvail(),i*0.08*Math.sin(alfam),-i*0.08*Math.cos(alfam));
  for(i=0;i<10;i++)
    if(i>=nhide)
      SetBallTarget(getAvail(),i*0.08*Math.sin(alfah),-i*0.08*Math.cos(alfah));
}

    </script>
  </head>
  <body onload="javascript:initWatch()" onresize="javascript:resizeWatch()">
    <canvas id="canvas" width="4" height="4" onclick="javascript:canvasClick()">Your browser does not support HTML5 canvas</canvas>
  </body>
</html>